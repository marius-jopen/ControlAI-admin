# ControlAI Admin Panel

Admin dashboard for managing users across all ControlAI applications (CELINE, IFM, THELIOS, Limn).

## Features

- ğŸ‘¥ **User Management**: View all registered users across all apps
- ğŸ” **User Details**: See user information, app access, credits, and status
- ğŸ–¼ï¸ **Image Gallery**: Browse all images generated by each user
- ğŸ” **Admin-Only Access**: Secure authentication with admin role requirement

## Setup

### 1. Install Dependencies

```bash
npm install
```

### 2. Environment Configuration

Create a `.env` file in the root directory:

```env
VITE_BACKEND_URL=http://localhost:3001
```

That's it! All data flows through the `controlai-server`, so no Supabase configuration is needed on the client.

### 3. Ensure Admin Access

The admin panel requires users to have `status = 'admin'` in the `user_app_settings` table. To grant admin access:

```sql
-- In Supabase SQL Editor
UPDATE user_app_settings
SET status = 'admin'
WHERE user_id = 'your-user-id' AND app_id = 'limn';
```

### 4. Run Development Server

```bash
npm run dev
```

Visit `http://localhost:5173` and log in with your admin credentials.

## Architecture

This admin panel is a separate SvelteKit application that:

- **Authenticates** via server API (`/api/v1/auth/login`)
- **Checks admin status** via server (checks `user_app_settings.status = 'admin'`)
- **Fetches all data** through server endpoints (never touches Supabase directly)
- **Uses new admin endpoints** in `controlai-server`:
  - `GET /api/v1/auth/admin/users` - Get all users with details
  - `GET /api/v1/auth/admin/users/:userId` - Get specific user
  - `GET /api/v1/auth/admin/users/:userId/images` - Get user's images

### Data Flow

```
Admin Panel â†’ controlai-server â†’ Supabase
     â†‘               â†“
  Browser      Admin endpoints
              (verify admin status)
```

All database queries happen server-side. The admin panel only makes HTTP requests to the server.

## UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” ControlAI Admin     user@email.com  Sign Outâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                   â”‚
â”‚  Users (42)  â”‚   User Information                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Search â”‚  â”‚   â”‚ Email: user@example.com â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚ ID: abc-123-def         â”‚    â”‚
â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â€¢ John Doe  â”‚                                   â”‚
â”‚  â€¢ Jane S... â”‚   Applications (3)                â”‚
â”‚  â€¢ Mike J... â”‚   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚
â”‚              â”‚   â”‚CELINEâ”‚ â”‚  IFM â”‚ â”‚ Limn â”‚    â”‚
â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                                   â”‚
â”‚              â”‚   Generated Images (147)          â”‚
â”‚              â”‚   [All Apps] [CELINE] [IFM]      â”‚
â”‚              â”‚   â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”          â”‚
â”‚              â”‚   â”‚imgâ”‚â”‚imgâ”‚â”‚imgâ”‚â”‚imgâ”‚          â”‚
â”‚              â”‚   â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Development

```bash
npm run dev      # Start dev server
npm run build    # Build for production
npm run preview  # Preview production build
npm run check    # Type check
```

## Future Enhancements

- âœï¸ Edit user roles and credits
- ğŸš« Block/unblock users
- ğŸ“Š Analytics and statistics
- ğŸ“¤ Export user data
- ğŸ”” Activity logs

---

**Note**: This admin panel is read-only for now. User modifications will be added in future updates through the `controlai-server` API.

